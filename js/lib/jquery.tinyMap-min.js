/**
 * jQuery tinyMap plugin
 * https://code.essoduke.org/tinyMap/
 * Copyright 2017 essoduke.org, Licensed MIT.
 *
 * @author Essoduke Chang<essoduke@gmail.com>
 * @license MIT License
 */
window.gMapsCallback=function(){$(window).trigger("gMapsCallback")},function($,e,o,t){"use strict";function n(e){var o=0,t,r;if(e instanceof Array)for(o=0;o<e.length;o+=1)n(e[o]);else if("object"==typeof e)for(t in e)"string"!=typeof e[t]?n(e[t]):/^google\.map/gi.test(e[t])&&(r=e[t].split("."),4===r.length&&(e[t]=google.maps[r[2]][r[3]]))}function r(e,o,t){var n={lat:"",lng:""},r=[],i=/^[+-]?\d+(\.\d+)?$/;if("string"==typeof e||Array.isArray(e)){if(r=Array.isArray(e)?e:e.toString().replace(/\s+/,"").split(","),2!==r.length)return e;i.test(r[0])&&i.test(r[1])&&(n.lat=r[0],n.lng=r[1])}else if("object"==typeof e){if("function"==typeof e.lat)return e;e.hasOwnProperty("x")&&e.hasOwnProperty("y")?(n.lat=e.x,n.lng=e.y):e.hasOwnProperty("lat")&&e.hasOwnProperty("lng")&&(n.lat=e.lat,n.lng=e.lng)}return void 0===t&&(n.lat=parseFloat(n.lat,10)+(Math.random()-.5)/5e3,n.lng=parseFloat(n.lng,10)+(Math.random()-.5)/5e3),!0===o?new google.maps.LatLng(n.lat,n.lng):n}function i(e){var o=this,t=e.hasOwnProperty("css")?e.css.toString():"";o.setValues(e),o.span=$("<span/>").css({position:"relative",left:"-50%",top:"0","white-space":"nowrap"}).addClass(t),o.div=$("<div/>").css({position:"absolute",display:"none"}),o.span.appendTo(o.div)}function a(o,t){var n=this,r=$.extend({},g,t);return n.idleOnceCount=!1,n.map=null,n._markers=[],n._markersCluster=[],n._clusters={},n._bounds={},n._labels=[],n._polylines=[],n._polygons=[],n._circles=[],n._kmls=[],n._directions=[],n._directionsMarkers=[],n._places=[],n.container=o,n.options=r,n.googleMapOptions={},n.interval=parseInt(n.options.interval,10)||200,$(e).on("gMapsCallback",function(){n.init()}),$(this.container).html(r.loading),n.init()}var s=!1,l=!1,c=!1,p=!1,d={language:"zh-TW",callback:"gMapsCallback",api:"https://maps.googleapis.com/maps/api/js",clusterer:"https://cdn.essoduke.org/js/tinyMap/markerclusterer.js",withLabel:"https://cdn.essoduke.org/js/tinyMap/markerwithlabel.js",OMS:"https://cdn.essoduke.org/js/tinyMap/oms.min.js"},g={autoLocation:!1,center:[24,121],infoWindowAutoClose:!0,interval:200,loading:"讀取中&hellip;",notFound:"找不到查詢的地點",zoom:8},f={},y;f={greyscale:[{featureType:"all",stylers:[{saturation:-100},{gamma:.5}]}]},a.prototype={VERSION:"3.4.10",formatSize:function(e){return Array.isArray(e)&&2===e.length?new google.maps.Size(e[0],e[1]):e},formatPoint:function(e){return Array.isArray(e)&&2===e.length?new google.maps.Point(e[0],e[1]):e},overlay:function(e){var o=this.map,t=this.options;try{this.idleOnceCount||(this.kml(o,t),this.directionService(o,t),this.placeMarkers(o,t),this.drawPolyline(o,t),this.drawPolygon(o,t),this.drawCircle(o,t),this.streetView(o,t),this.places(o,t),this.geoLocation(o,t),this.idleOnceCount=!0)}catch(e){console.error(e)}finally{google.maps.event.trigger(o,"resize")}},bindEvents:function(e,o){var t=this,n={};switch(typeof o){case"function":google.maps.event.clearListeners(e,"click"),google.maps.event.addListener(e,"click",o);break;case"object":for(n in o)"function"==typeof o[n]?"created"===n?o[n].call(e):(google.maps.event.clearListeners(e,n),google.maps.event.addListener(e,n,o[n])):o[n].hasOwnProperty("func")&&"function"==typeof o[n].func?o[n].hasOwnProperty("once")&&!0===o[n].once?google.maps.event.addListenerOnce(e,n,o[n].func):(google.maps.event.clearListeners(e,n),google.maps.event.addListener(e,n,o[n].func)):"function"==typeof o[n]&&(google.maps.event.clearListeners(e,n),google.maps.event.addListener(e,n,o[n]));break}e.hasOwnProperty("defaultInfoWindow")&&(google.maps.event.clearListeners(e,"click"),google.maps.event.addListener(e,"click",function(){var o=0,n={};if(t.options.hasOwnProperty("infoWindowAutoClose")&&!0===t.options.infoWindowAutoClose)for(o=0;o<t._markers.length;o+=1)n=t._markers[o],n.hasOwnProperty("infoWindow")&&"function"==typeof n.infoWindow.close&&n.infoWindow.close();e.infoWindow.open(t.map,e)}))},kml:function(e,o){var t=this,n={url:"",map:e,preserveViewport:!1,suppressInfoWindows:!1},r={},i=0;if(o.hasOwnProperty("kml"))if("string"==typeof o.kml)n.url=o.kml,r=new google.maps.KmlLayer(n),this._kmls.push(r);else if(Array.isArray(o.kml))for(i=0;i<o.kml.length;i+=1)"string"==typeof o.kml[i]?(n.url=o.kml[i],r=new google.maps.KmlLayer(n)):"object"==typeof o.kml[i]&&(n=$.extend({},n,o.kml[i]),r=new google.maps.KmlLayer(n),n.hasOwnProperty("event")&&t.bindEvents(r,n.event)),this._kmls.push(r)},drawPolyline:function(e,o){var t=this,n={},i=[],a={},s={},l={},c={},p=[],d=[],g=0,f={},y={},h=0,u=function(e,o){if(o===google.maps.DirectionsStatus.OK){for(h=0;h<e.routes[0].overview_path.length;h+=1)d.push(e.routes[0].overview_path[h]);a.setPath(d),"function"==typeof n.getDistance&&(s=e.routes[0].legs[0].distance,n.getDistance.call(this,s))}};if(o.hasOwnProperty("polyline")&&Array.isArray(o.polyline))for(g=0;g<o.polyline.length;g+=1)if(n=o.polyline[g],n.hasOwnProperty("coords")&&Array.isArray(n.coords)){for(p=new google.maps.MVCArray,h=0;h<n.coords.length;h+=1)y=n.coords[h],f=r(y,!0,!1),"function"==typeof f.lat&&p.push(f);if(c=$.extend({},{strokeColor:n.color||"#FF0000",strokeOpacity:n.opacity||1,strokeWeight:n.width||2},n),a=new google.maps.Polyline(c),t._polylines.push(a),2<p.getLength())for(h=0;h<p.length;h+=1)0<h&&p.length-1>h&&i.push({location:p.getAt(h),stopover:!1});n.hasOwnProperty("event")&&t.bindEvents(a,n.event),n.hasOwnProperty("snap")&&!0===n.snap?(l=new google.maps.DirectionsService,l.route({origin:p.getAt(0),waypoints:i,destination:p.getAt(p.length-1),travelMode:google.maps.DirectionsTravelMode.DRIVING},u)):(a.setPath(p),google.maps.hasOwnProperty("geometry")&&google.maps.geometry.hasOwnProperty("spherical")&&"function"==typeof google.maps.geometry.spherical.computeDistanceBetween&&(s=google.maps.geometry.spherical.computeDistanceBetween(p.getAt(0),p.getAt(p.length-1)),"function"==typeof n.getDistance&&n.getDistance.call(t,s))),a.setMap(e)}},drawPolygon:function(e,o){var t=this,n={},i={},a=[],s=0,l=0,c={},p={};if(o.hasOwnProperty("polygon")&&Array.isArray(o.polygon))for(s=0;s<o.polygon.length;s+=1)if(a=[],o.polygon[s].hasOwnProperty("coords")){for(l=0;l<o.polygon[s].coords.length;l+=1)c=o.polygon[s].coords[l],p=r(c,!0,!1),"function"==typeof p.lat&&a.push(p);i=$.extend({},{path:a,strokeColor:o.polygon[s].color||"#FF0000",strokeOpacity:1,strokeWeight:o.polygon[s].width||2,fillColor:o.polygon[s].fillcolor||"#CC0000",fillOpacity:.35},o.polygon[s]),n=new google.maps.Polygon(i),t._polygons.push(n),n.setMap(e),i.hasOwnProperty("event")&&t.bindEvents(n,i.event)}},drawCircle:function(e,o){var t=this,n={},i={},a={},s={},l=0;if(o.hasOwnProperty("circle")&&Array.isArray(o.circle))for(l=0;l<o.circle.length;l+=1)i=o.circle[l],a=$.extend({map:e,strokeColor:i.color||"#FF0000",strokeOpacity:i.opacity||.8,strokeWeight:i.width||2,fillColor:i.fillcolor||"#FF0000",fillOpacity:i.fillopacity||.35,radius:i.radius||10,zIndex:100,id:i.hasOwnProperty("id")?i.id:""},i),i.hasOwnProperty("center")&&(s=r(i.center,!0,!1),a.center=s),"function"==typeof s.lat&&(n=new google.maps.Circle(a),t._circles.push(n),i.hasOwnProperty("event")&&t.bindEvents(n,i.event))},markerIcon:function(e){var o={};if(e.hasOwnProperty("icon")){if(o=e.icon,"string"==typeof e.icon)return e.icon;e.icon.hasOwnProperty("url")&&(o.url=e.icon.url),e.icon.hasOwnProperty("size")&&Array.isArray(e.icon.size)&&2===e.icon.size.length&&(o.size=this.formatSize(e.icon.size)),e.icon.hasOwnProperty("scaledSize")&&Array.isArray(e.icon.scaledSize)&&2===e.icon.scaledSize.length&&(o.scaledSize=this.formatSize(e.icon.scaledSize)),e.icon.hasOwnProperty("anchor")&&Array.isArray(e.icon.anchor)&&2===e.icon.anchor.length&&(o.anchor=this.formatPoint(e.icon.anchor))}return o},processMarker:function(e,o,t,n,r){var a=this,s=a.get("marker"),l={},c={},p={},d={};n.hasOwnProperty("position")&&("function"==typeof n.getPosition&&a._bounds.extend(n.position),t.hasOwnProperty("markerFitBounds")&&!0===t.markerFitBounds&&s.length===t.marker.length&&o.fitBounds(a._bounds)),void 0===n.infoWindow&&(n.infoWindow=new google.maps.InfoWindow({content:n.text})),n.hasOwnProperty("text")&&(n.infoWindow.setContent(n.text),n.hasOwnProperty("event")&&n.event.hasOwnProperty("click")||(n.defaultInfoWindow=!0),a.bindEvents(n,n.event),n.hasOwnProperty("infoWindowOptions")&&(p=$.extend({},{content:n.infoWindowOptions.hasOwnProperty("content")?n.infoWindowOptions.content:n.text},n.infoWindowOptions),n.infoWindow.setOptions(p),p.hasOwnProperty("event")&&void 0!==p.event&&a.bindEvents(n.infoWindow,p.event))),(!n.hasOwnProperty("cluster")||n.hasOwnProperty("cluster")&&!0===n.cluster)&&"function"==typeof a._clusters.addMarker&&a._clusters.addMarker(n),(t.hasOwnProperty("markerWithLabel")&&!0===t.markerWithLabel||n.hasOwnProperty("newLabel")&&n.newLabel)&&(c={id:n.id,text:n.newLabel,map:o,css:n.hasOwnProperty("newLabelCSS")?n.newLabelCSS.toString():""},a.get({label:[n.id]},function(e){var o=0,r=e.label.length,s={};r?e.label.forEach(function(e){e.text=n.newLabel,$(e.span).addClass(n.newLabelCSS),e.bindTo("position",n),e.draw()}):(l=new i(c),l.bindTo("position",n),a._labels.push(l),l.set("visible",n.showLabel),"object"==typeof l&&!0===t.markerCluster&&google.maps.event.addListener(n,"map_changed",function(){"function"==typeof l.setMap&&l.set("visible",null!==n.getMap())}))})),a.bindEvents(n,n.event)},markerControl:function(){var e=this,o=e.options,t={css:"",label:"請選擇&hellip;",infoWindow:!0,panTo:!0,onChange:""},n;o.hasOwnProperty("markerControl")&&("string"==typeof o.markerControl?n=$(o.markerControl.toString()):(n=$(o.markerControl.hasOwnProperty("container")?o.markerControl.container:o.markerControl),t=$.extend({},t,o.markerControl)),n.length&&e.get("marker",function(o){var r=['<select class="marker-list-control">',"<option>"+t.label+"</option>"];o.forEach(function(e){void 0!==e.infoWindow&&e.infoWindow.close(),r.push('<option value="'+e.id+'" data-marker-id="'+e.id+'">'+(e.title?e.title:e.id)+"</option>")}),r.push("</select>"),n.on("change.tinyMap","select",function(){var o=$(this);e.close("marker"),this.value.length&&e.get({marker:[this.value]},function(n){var r={};n.marker.length&&"undefined"!==n.marker[0]&&(r=n.marker[0],!0===t.infoWindow&&void 0!==r.infoWindow&&"function"==typeof r.infoWindow.open&&r.infoWindow.open(e.map,r),!0===t.panTo&&e.map.panTo(r.getPosition()),"function"==typeof t.onChange&&t.onChange.call(o,r))})}).html(r.join("")),"string"==typeof t.css&&n.find("select").addClass(t.css)}))},placeMarkers:function(e,o,t,n){var a=this,s={},l={maxZoom:null,gridSize:60},c=Array.isArray(o.marker)?o.marker:[],p=[],d={},g=!1,f,y=function(e){return"https://chart.googleapis.com/chart?chst=d_map_xpin_letter&chld=pin|+|"+e+"|000000|ffff00"};void 0!==n&&Array.isArray(n)&&n.length&&(c=n),a.options.hasOwnProperty("markerCluster")&&"function"==typeof MarkerClusterer&&(l=$.extend({},l,o.markerCluster),a._clusters=new MarkerClusterer(e,[],l),l.hasOwnProperty("event")&&a.bindEvents(a._clusters,l.event)),a.options.hasOwnProperty("enableOMS")&&"function"==typeof OverlappingMarkerSpiderfier&&(g=!0),g&&(d=new OverlappingMarkerSpiderfier(e,{markersWontHide:!0}),d.addListener("click",function(o){o.hasOwnProperty("oms")&&o.infoWindow.setContent(o.oms),o.infoWindow.open(e,o)}),d.addListener("spiderfy",function(e){var o=0}),d.addListener("unspiderfy",function(e){var o=0}));var h=c.length;if(c.forEach(function(n,i){var l=r(n.addr,!0),c=a.markerIcon(n),p=!0,f=!1,y={},u={},m=void 0!==n.id?n.id:n.addr.toString().replace(/\s/g,""),w={id:m,map:e,animation:null,showLabel:!0};w=$.extend({},w,n),"modify"===t&&m&&a.get({marker:[m]},function(e){Array.isArray(e.marker)&&e.marker.length&&(n.hasOwnProperty("forceInsert")&&!0===n.forceInsert||(n=$.extend(e.marker[0],n),"function"==typeof a._clusters.removeMarker&&a._clusters.removeMarker(e.marker[0]),p=!1,f=!0))}),n.hasOwnProperty("title")&&(w.title=n.title.toString().replace(/<([^>]+)>/g,"")),$.isEmptyObject(c)||(w.icon=c),n.hasOwnProperty("animation")&&"string"==typeof n.animation&&(w.animation=google.maps.Animation[n.animation.toUpperCase()]),"string"==typeof l?(s=new google.maps.Geocoder,s.geocode({address:l},function(r,s){s===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?setTimeout(function(){a.placeMarkers(h,e,o,t,[n])},a.interval*(i+1)):s===google.maps.GeocoderStatus.OK&&(!p&&f?("function"==typeof n.setPosition&&(n.setPosition(r[0].geometry.location),w.hasOwnProperty("title")&&n.setTitle(w.title),w.hasOwnProperty("icon")&&n.setIcon(w.icon)),u=n):(w.position=r[0].geometry.location,y=o.hasOwnProperty("markerWithLabel")&&!0===o.markerWithLabel&&"function"==typeof MarkerWithLabel?new MarkerWithLabel(w):new google.maps.Marker(w),a._markers.push(y),u=y),g&&d.addMarker(u),a.processMarker(h,e,o,u,t))})):(!p&&f?("function"==typeof n.setPosition&&l.lat()&&l.lng()&&n.setPosition(l),w.hasOwnProperty("title")&&n.setTitle(w.title),w.hasOwnProperty("icon")&&n.setIcon(w.icon),u=n):(w.position=l,y=o.hasOwnProperty("markerWithLabel")&&!0===o.markerWithLabel&&"function"==typeof MarkerWithLabel?new MarkerWithLabel(w):new google.maps.Marker(w),a._markers.push(y),u=y,g&&d.addMarker(u)),a.processMarker(h,e,o,u,t))}),o.hasOwnProperty("markerWithLabel")&&$.isNumeric(o.markerWithLabel)){({idle:{func:function(){a.clear("label");var o=e.getCenter(),t=[];a.get("marker",function(n){n.forEach(function(e){google.maps.geometry.spherical.computeDistanceBetween(e.getPosition(),o)<1e3&&t.push(e)}),t&&t.forEach(function(o){var t={id:o.id,text:o.newLabel,map:e,css:o.hasOwnProperty("newLabelCSS")?o.newLabelCSS.toString():""},n=new i(t);n.bindTo("position",o),n.set("visible",o.showLabel),a._labels.push(n)})})},once:!1}}).idle.func.apply(a,arguments)}a.markerControl()},directionService:function(e,o){var t=this,n=new google.maps.DirectionsService;Array.isArray(o.direction)&&o.direction.forEach(function(o){if(void 0!==o.from&&void 0!==o.to){var i={},a=new google.maps.DirectionsRenderer,s=$.extend({},{infoWindow:new google.maps.InfoWindow,map:t.map},o),l=[],c=[],p=[];i.origin=r(o.from,!0,!1),i.destination=r(o.to,!0,!1),i.travelMode=o.hasOwnProperty("travel")&&google.maps.TravelMode[o.travel.toString().toUpperCase()]?google.maps.TravelMode[o.travel.toString().toUpperCase()]:google.maps.TravelMode.DRIVING,o.hasOwnProperty("panel")&&$(o.panel).length&&(s.panel=$(o.panel).get(0)),o.hasOwnProperty("requestExtra")&&o.requestExtra&&(i=$.extend({},i,o.requestExtra)),o.hasOwnProperty("optimize")&&(i.optimizeWaypoints=o.optimize),o.hasOwnProperty("waypoint")&&Array.isArray(o.waypoint)&&(o.waypoint.forEach(function(e){var o={stopover:!0};"string"==typeof e||Array.isArray(e)?o.location=r(e,!0):e.hasOwnProperty("location")&&(o.location=r(e.location,!0),o.stopover=!e.hasOwnProperty("stopover")||e.stopover),c.push(e.text||e.toString()),e.hasOwnProperty("icon")&&p.push(e.icon.toString()),l.push(o)}),i.waypoints=l),n.route(i,function(n,r){r===google.maps.DirectionsStatus.OK&&(n.routes.forEach(function(r,a){if(o.hasOwnProperty("renderAll")&&!0===o.renderAll&&!0===i.provideRouteAlternatives)var l=new google.maps.DirectionsRenderer({map:e,directions:n,routeIndex:a});var d=r.legs,g="",f="",y={},h=0;for(o.hasOwnProperty("fromText")&&(d[0].start_address=o.fromText,g=o.fromText),o.hasOwnProperty("toText")&&(1===d.length?d[0].end_address=o.toText:d[d.length-1].end_address=o.toText,f=o.toText),o.hasOwnProperty("icon")&&(s.suppressMarkers=!0,o.icon.hasOwnProperty("from")&&"string"==typeof o.icon.from&&t.directionServiceMarker(d[0].start_location,{icon:o.icon.from,text:g},s.infoWindow,o),o.icon.hasOwnProperty("to")&&"string"==typeof o.icon.to&&t.directionServiceMarker(d[d.length-1].end_location,{icon:o.icon.to,text:f},s.infoWindow,o)),h=1;h<d.length;h+=1)o.hasOwnProperty("icon")&&(o.icon.hasOwnProperty("waypoint")&&"string"==typeof o.icon.waypoint?y.icon=o.icon.waypoint:"string"==typeof p[h-1]&&(y.icon=p[h-1]),y.text=c[h-1],t.directionServiceMarker(d[h].start_location,y,s.infoWindow,o))}),console.log(s),t.bindEvents(a,o.event),a.setOptions(s),a.setDirections(n),t._directions.push(a))})}})},directionServiceMarker:function(e,o,t,n){var r=this,i={},a=$.extend({},{position:e,map:r.map,id:n.hasOwnProperty("id")?n.id:""},o),s=new google.maps.Marker(a);a.hasOwnProperty("text")&&(i=function(){t.setPosition(e),t.setContent(a.text),t.open(r.map,s)}),r._directionsMarkers.push(s),r.bindEvents(s,i)},getDirectionsInfo:function(){var e=[];return this.get("direction",function(o){o.forEach(function(o,t){var n=o.getDirections();n.hasOwnProperty("routes")&&void 0!==n.routes[0]&&void 0!==n.routes[0].legs&&(e[t]=[],n.routes[0].legs.forEach(function(o,n){e[t].push({from:o.start_address,to:o.end_address,distance:o.distance,duration:o.duration})}))})}),e},streetView:function(e,o){var t=this,n=o.hasOwnProperty("streetViewObj")?o.streetViewObj:{},i={},a={};"function"==typeof e.getStreetView&&(n.hasOwnProperty("position")?(a=r(n.position,!0,!1),n.position="object"==typeof a?e.getCenter():a):n.position=e.getCenter(),n.hasOwnProperty("pov")&&(n.pov=$.extend({},{heading:0,pitch:0,zoom:1},n.pov)),i=e.getStreetView(),i.setOptions(n),n.hasOwnProperty("event")&&t.bindEvents(i,n.event),n.hasOwnProperty("visible")&&i.setVisible(n.visible))},places:function(e,o){var t=this,n={},i=o.hasOwnProperty("places")?o.places:{},a=$.extend({location:e.getCenter(),radius:100},i);a.location=r(a.location,!0,!1),void 0!==google.maps.places&&(n=new google.maps.places.PlacesService(e),n.nearbySearch(a,function(o,n){n===google.maps.places.PlacesServiceStatus.OK&&(t._places.push(o),a.hasOwnProperty("createMarker")&&!0===a.createMarker&&o.forEach(function(o){o.hasOwnProperty("geometry")&&t._markers.push(new google.maps.Marker({map:e,position:o.geometry.location}))}),a.hasOwnProperty("callback")&&"function"==typeof a.callback&&a.callback.call(o))}))},geoLocation:function(e,o){try{var t=this,n={},r=navigator.geolocation;if(!r)return;o.hasOwnProperty("geolocation")&&(n=$.extend({},{maximumAge:6e5,timeout:3e3,enableHighAccuracy:!1},o.geolocation)),!0===o.autoLocation||"function"==typeof o.autoLocation?this.watchid=r.watchPosition(function(n){void 0!==n&&"coords"in n&&"latitude"in n.coords&&"longitude"in n.coords&&(e.panTo(new google.maps.LatLng(n.coords.latitude,n.coords.longitude)),"function"==typeof o.autoLocation&&o.autoLocation.call(t,n))},function(e){console.error(e)},n):r.clearWatch(this.watchid)}catch(e){}},panTo:function(e,o){var t=this,n=this.map,i={},a={};return null!==n&&void 0!==n&&(i=r(e,!0,!1),"string"==typeof i?(a=new google.maps.Geocoder,a.geocode({address:i},function(e,t){t===google.maps.GeocoderStatus.OK&&"function"==typeof n.panTo&&Array.isArray(e)&&e.length?e[0].hasOwnProperty("geometry")&&n.panTo(e[0].geometry.location):"function"==typeof o?o.call(this,t):console.error(t)})):"function"==typeof n.panTo&&n.panTo(i)),$(this.container)},close:function(e,o){var t=this,n=t.get(e),r={},i="";n.hasOwnProperty("map")&&delete n.map,Array.isArray(n)?r[e]=n:r=n;try{for(i in r)Array.isArray(r[i])&&r[i].forEach(function(e){e.hasOwnProperty("infoWindow")&&"function"==typeof e.infoWindow.close&&e.infoWindow.close()});"function"==typeof o&&o.call(this)}catch(e){console.warn(e)}finally{return $(t.container)}},clear:function(e,o){function t(e,o){"function"==typeof e.setMap&&i._directionsMarkers[o].setMap(null)}function n(e){"direction"===p&&(a.forEach(t),i._directionsMarkers.filter(function(e){return void 0!==e})),"function"==typeof e.set&&e.set("visible",!1),"function"==typeof e.setMap&&e.setMap(null),-1!==i[c].indexOf(e)&&delete i[c][i[c].indexOf(e)]}function r(e){return void 0!==e}var i=this,a=i._directionsMarkers,s=i.get(e),l={},c="",p="";void 0!==s&&void 0!==s.map&&delete s.map,Array.isArray(s)?l[e]=s:l=s;try{for(p in l)Array.isArray(l[p])&&(c="_"+p.toString().toLowerCase()+"s",l[p].forEach(n),i[c]=i[c].filter(r));"function"==typeof o&&o.call(this)}catch(e){console.warn(e)}finally{return $(i.container)}},get:function(e,o){function t(o){var t=n[s].indexOf(o);(0===e[a].length||-1!==e[a].indexOf(t)||void 0!==o.id&&0<o.id.length&&-1!==o.id.indexOf(e[a]))&&i[a].push(o)}var n=this,r=[],i={},a={},s="",l="",c=0;void 0===e&&(e={marker:[],label:[],polygon:[],polyline:[],circle:[],direction:[],kml:[],cluster:[],bound:[]});try{if("string"==typeof e)if(-1!==e.indexOf(","))for(r=e.replace(/\s/gi,"").split(","),c=0;c<r.length;c+=1)l=r[c].toString().toLowerCase(),"map"===l?i[l]=n.map:(console.log(l),s="_"+l+"s",i[l]=n[s]);else"map"===e.toString().toLowerCase()?i=n.map:(s="_"+e.toString().toLowerCase()+"s",i=n[s]);else{for(a in e)Array.isArray(e[a])&&(s="_"+a.toString().toLowerCase()+"s",Array.isArray(n[s])&&(i[a]=[],n[s].forEach(t)));i.map=n.map}return"function"==typeof o&&o.call(this,i),i}catch(e){console.error(e)}finally{return i}},modify:function(e){var o=this,t=[],n=[["kml","kml"],["marker","placeMarkers"],["direction","directionService"],["polyline","drawPolyline"],["polygon","drawPolygon"],["circle","drawCircle"],["streetView","streetView"],["markerFitBounds","markerFitBounds"],["places","places"],["autoLocation","geoLocation"]],r=0,i=o.map;if(void 0!==e){for(r=0;r<n.length;r+=1)e.hasOwnProperty(n[r][0])&&t.push(n[r][1]);if(null!==i){if(t.length)for(r=0;r<t.length;r+=1)"function"==typeof o[t[r]]&&("streetView"===t[r]&&(e.streetViewObj=e.streetView,delete e.streetView),o[t[r]](i,e,"modify"));else i.setOptions(e);e.hasOwnProperty("event")&&o.bindEvents(i,e.event),google.maps.event.trigger(i,"resize")}}return $(this.container)},query:function(e,o){var t=this,n=new google.maps.Geocoder,i=r(e,!1,!0),a={};"string"==typeof i?a.address=i:a={location:{lat:parseFloat(i.lat,10),lng:parseFloat(i.lng,10)}},n.geocode(a,function(n,r){try{if(r===google.maps.GeocoderStatus.OVER_QUERY_LIMIT)setTimeout(function(){t.query(e,o)},t.interval);else if(r===google.maps.GeocoderStatus.OK&&Array.isArray(n)){if(0<n.length&&n[0].hasOwnProperty("geometry")){if("function"!=typeof o)return n[0];o.call(t,n[0])}}else console.error("Geocoder Error Code: "+r)}catch(e){console.error(e)}})},destroy:function(){var e=$(this.container);return e.length&&$.removeData(this.container,"tinyMap"),e.empty()},getKML:function(o){var t=this,n=$.extend({},{marker:!0,polyline:!0,polygon:!0,circle:!0,direction:!0,download:!1},o),r="data:application/vnd.google-earth.kml+xml;charset=utf-8;base64,",i={xml:['<?xml version="1.0" encoding="UTF-8"?>','<kml xmlns="http://earth.google.com/kml/2.2">',"<Document>","<name><![CDATA[jQuery tinyMap Plugin]]></name>","<description><![CDATA[]]></description>",'<Style id="style1">',"<PolyStyle>","<color>50F05A14</color>","<colorMode>normal</colorMode>","<fill>1</fill>","<outline>1</outline>","</PolyStyle>","<IconStyle>","<Icon>","<href>https://maps.google.com/mapfiles/kml/paddle/grn-circle_maps.png</href>","</Icon>","</IconStyle>","</Style>","#PLACEMARKS#","</Document>","</kml>"],placemark:["<Placemark>","<name><![CDATA[#NAME#]]></name>","<Snippet></Snippet>","<description><![CDATA[]]></description>","<styleUrl>#style1</styleUrl>","<ExtendedData></ExtendedData>","#DATA#","</Placemark>"],polygon:["<Placemark>","<styleUrl>#style1</styleUrl>","<name><![CDATA[#NAME#]]></name>","<Polygon>","<tessellate>1</tessellate>","<extrude>1</extrude>","<altitudeMode>clampedToGround</altitudeMode>","<outerBoundaryIs>","<LinearRing>","<coordinates>#LATLNG#</coordinates>","</LinearRing>","</outerBoundaryIs>","</Polygon>","</Placemark>"],linestring:"<LineString><tessellate>1</tessellate><coordinates>#LATLNG#</coordinates></LineString>",point:"<Point><coordinates>#LATLNG#,0.000000</coordinates></Point>"},a="",s="",l="",c="",p="",d="";if(t.get("marker,polyline,polygon,circle,direction",function(e){var o="";!0===n.marker&&void 0!==e.marker&&e.marker.forEach(function(e){o=[e.getPosition().lng(),e.getPosition().lat()].join(","),a+=i.placemark.join("").replace(/#NAME#/gi,"Markers").replace(/#DATA#/gi,i.point.replace(/#LATLNG#/gi,o))}),!0===n.polyline&&void 0!==e.polyline&&e.polyline.forEach(function(e){o="",e.getPath().getArray().forEach(function(e){o+=[e.lng(),e.lat(),"0.000000\n"].join(",")}),s+=i.placemark.join("").replace(/#NAME#/gi,"Polylines").replace(/#DATA#/gi,i.linestring.replace(/#LATLNG#/gi,o))}),!0===n.polygon&&void 0!==e.polygon&&e.polygon.forEach(function(e){o="",e.getPath().getArray().forEach(function(e){o+=[e.lng(),e.lat(),"0.000000\n"].join(",")}),l+=i.polygon.join("").replace(/#NAME#/gi,"Polygons").replace(/#LATLNG#/gi,o)}),!0===n.circle&&void 0!==e.circle&&e.circle.forEach(function(e){o="";var t=Math.PI/180,n=180/Math.PI,r=6378137,a=64,s=e.getRadius()/6378137*n,l=s/Math.cos(e.getCenter().lat()*t),p=0,d=0,g=0,f=0;for(f=0;f<65;f+=1)p=Math.PI*(f/32),d=e.getCenter().lng()+l*Math.cos(p),g=e.getCenter().lat()+s*Math.sin(p),o+=[d,g,"0.000000\n"].join(",");c+=i.polygon.join("").replace(/#NAME#/gi,"Circles").replace(/#LATLNG#/gi,o)}),!0===n.direction&&void 0!==e.direction&&e.direction.forEach(function(e){var t=e.getDirections();t.hasOwnProperty("routes")&&Array.isArray(t.routes)&&void 0!==t.routes[0]&&void 0!==t.routes[0].legs&&Array.isArray(t.routes[0].legs)&&t.routes[0].legs.forEach(function(e){Array.isArray(e.steps)&&e.steps.forEach(function(e){o="",Array.isArray(e.path)&&e.path.forEach(function(e){o+=[e.lng(),e.lat(),"0.000000\n"].join(",")}),p+=i.placemark.join("").replace(/#NAME#/gi,"Directions").replace(/#DATA#/gi,i.linestring.replace(/#LATLNG#/gi,o))})})})}),d=i.xml.join("").replace(/#NAME#/gi,"").replace(/#PLACEMARKS#/gi,a+s+l+c+p),!0!==n.download)return d;e.open(r+e.btoa(e.decodeURIComponent(e.encodeURIComponent(d))))},init:function t(){var a=this,g={},y={},h=$.extend({},d),u=h.api.split("?")[0],m="",w={},v={},k=!0,O;try{delete h.api,delete h.clusterer,delete h.withLabel,h=$.param(h)}catch(e){}if(s||void 0!==e.google||(g=o.createElement("script"),g.setAttribute("src",[u,h].join("?")),(o.getElementsByTagName("head")[0]||o.documentElement).appendChild(g),s=!0,g=null),"object"==typeof e.google){n(a.options),!l&&a.options.hasOwnProperty("markerCluster")&&!1!==a.options.markerCluster&&"undefined"==typeof MarkerClusterer&&(g=o.createElement("script"),g.setAttribute("src",d.clusterer),(o.getElementsByTagName("head")[0]||o.documentElement).appendChild(g),l=!0,g=null),!c&&a.options.hasOwnProperty("markerWithLabel")&&!0===a.options.markerWithLabel&&"undefined"==typeof MarkerWithLabel&&(g=o.createElement("script"),g.setAttribute("src",d.withLabel),(o.getElementsByTagName("head")[0]||o.documentElement).appendChild(g),c=!0,g=null),!p&&a.options.hasOwnProperty("enableOMS")&&"undefined"==typeof OverlappingMarkerSpiderfier&&(g=o.createElement("script"),g.setAttribute("src",d.OMS),(o.getElementsByTagName("head")[0]||o.documentElement).appendChild(g),p=!0,g=null),a._bounds=new google.maps.LatLngBounds,i.prototype=new google.maps.OverlayView,i.prototype.onAdd=function(){var e=this;null!==e.div&&(e.div.appendTo($(e.getPanes().overlayLayer)),e.listeners=[google.maps.event.addListener(e,"visible_changed",function(){e.draw()}),google.maps.event.addListener(e,"position_changed",function(){e.draw()}),google.maps.event.addListener(e,"visible_changed",function(){e.draw()}),google.maps.event.addListener(e,"clickable_changed",function(){e.draw()}),google.maps.event.addListener(e,"text_changed",function(){e.draw()}),google.maps.event.addListener(e,"zindex_changed",function(){e.draw()})])},i.prototype.draw=function(){var e=this,o=e.getProjection(),t={};try{null!==e.div&&o&&(t=o.fromLatLngToDivPixel(e.get("position")),t&&e.div.css({left:t.x+"px",top:t.y+"px",display:e.get("visible")?"block":"none"}),e.text&&e.span.html(e.text.toString()))}catch(e){console.error(e)}},i.prototype.onRemove=function(){$(this.div).remove(),this.div=null};for(v in a.options)a.options.hasOwnProperty(v)&&(w=a.options[v],/ControlOptions/g.test(v)&&w.hasOwnProperty("position")&&"string"==typeof w.position&&(a.options[v].position=google.maps.ControlPosition[w.position.toUpperCase()]));a.googleMapOptions=a.options,a.options.hasOwnProperty("streetView")&&(a.googleMapOptions.streetViewObj=a.options.streetView,delete a.googleMapOptions.streetView),a.googleMapOptions.center=r(a.options.center,!0,!1),a.options.hasOwnProperty("styles")&&("string"==typeof a.options.styles&&f.hasOwnProperty(a.options.styles)?a.googleMapOptions.styles=f[a.options.styles]:Array.isArray(a.options.styles)&&(a.googleMapOptions.styles=a.options.styles)),"string"==typeof a.options.center?(y=new google.maps.Geocoder,y.geocode({address:a.options.center},function(e,o){try{o===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?setTimeout(function(){a.init()},a.interval):o===google.maps.GeocoderStatus.OK&&Array.isArray(e)?0<e.length&&e[0].hasOwnProperty("geometry")&&(a.googleMapOptions.center=e[0].geometry.location,a.map=new google.maps.Map(a.container,a.googleMapOptions),O=void 0!==a.options.event?a.options.event:{},a.mapIdleEvent(O)):(m=(a.options.notFound||o).toString(),a.container.innerHTML=$("<div/>").text(m).html(),console.error("Geocoder Error Code: "+o))}catch(e){console.error(e)}})):(a.map=new google.maps.Map(a.container,a.googleMapOptions),O=void 0!==a.options.event?a.options.event:{},a.mapIdleEvent(O))}},mapIdleEvent:function(e){var o=this;e.hasOwnProperty("idle")?"undefined"!==e.idle.func&&"function"==typeof e.idle.func&&void 0!==e.idle.once?(!0===e.idle.once?google.maps.event.addListenerOnce(o.map,"idle",function(){o.overlay(),e.idle.func.apply(this,arguments),delete e.idle}):google.maps.event.addListener(o.map,"idle",function(){o.overlay(),e.idle.func.apply(this,arguments)}),o.bindEvents(o.map,e)):("function"==typeof e.idle&&google.maps.event.addListener(o.map,"idle",function(){o.overlay(),e.idle.apply(this,arguments)}),o.bindEvents(o.map,e)):(google.maps.event.addListenerOnce(o.map,"idle",function(){o.overlay()}),o.bindEvents(o.map,e))}},$.fn.tinyMapConfigure=function(e){d=$.extend(d,e)},$.fn.tinyMap=function(e){var o={},t=[],n=arguments,r="tinyMap";return"string"==typeof e?(this.each(function(){(o=$.data(this,r))instanceof a&&"function"==typeof o[e]&&(t=o[e].apply(o,Array.prototype.slice.call(n,1)))}),void 0!==t?t:this):this.each(function(){$.data(this,r)||$.data(this,r,new a(this,e))})}}(window.jQuery||{},window,document);